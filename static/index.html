<!doctype html>
<title>contained.af</title>
<link href="normalize.css" media="all" rel="stylesheet" />
<style>
body {
    background: #000;
}
.terminal {
    float: left;
    border: #000 solid 5px;
    font-family: "DejaVu Sans Mono", "Liberation Mono", monospace;
    font-size: 11px;
    color: #f0f0f0;
    background: #000;
}
.terminal-cursor {
    color: #000;
    background: #f0f0f0;
}
</style>
<script src="term.js"></script>
<script>
;(function() {
    window.onload = function() {
        var w = window,
            d = document,
            e = d.documentElement,
            g = d.getElementsByTagName('body')[0],
            x = w.innerWidth,
            y = w.innerHeight;

        var socket = new WebSocket('ws://'+location.host+"/term");
        var term = new Terminal({
            cols: x,
            rows: y,
            useStyle: true,
            screenKeys: true,
            cursorBlink: false
        });
        term.on('title', function(title) {
            document.title = title;
        });
        term.open(document.body);
        socket.onopen = function (event) {
            socket.send(JSON.stringify({
                type: 'run',
                width: x,
                height: y
            }));
        };
        term.on('data', function(data) {
            socket.send(JSON.stringify({
                type:'stdin',
                data: data
            }));
        });
        socket.onmessage = function (event) {
            //console.log("input", JSON.stringify(event));
            var obj = JSON.parse(event.data);
            //console.log("data", obj.data);
            term.write(obj.data);
        };
        socket.onclose = function (event) {
            term.destroy()
        };
        window.onresize = function(event) {
            var w = window,
                d = document,
                e = d.documentElement,
                g = d.getElementsByTagName('body')[0],
                x = w.innerWidth,
                y = w.innerHeight;

            socket.send(JSON.stringify({
                type: 'resize',
                width: x,
                height: y
            }));
        };
    };
}).call(this);
</script>
